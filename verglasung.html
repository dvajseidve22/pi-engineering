<!DOCTYPE html>
<html lang="de-CH">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>PI-ENGINEERING</title>

    <!-- Preconnects -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin />
    <link rel="preconnect" href="https://cdn.jsdelivr.net/npm" crossorigin />

    <!-- Preload hero background (LCP) -->
    <link rel="preload" as="image" href="./images/Staklo/17.jpg" imagesrcset="./images/Staklo/17.jpg 1200w" imagesizes="100vw" />

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />

    <!-- Твој CSS -->
    <link rel="stylesheet" href="./styling/verglasung.css" />
    <link rel="icon" href="./images/logo.jpg" sizes="16x16" type="image/png" />
  </head>

  <body>
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg bg-color py-3">
      <div class="container-fluid">
        <a class="navbar-brand" href="index.html">
          <img src="./images/logo.jpg" alt="Logo" class="logo" decoding="async" loading="lazy" width="300" height="150" />
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav mx-auto">
            <li class="nav-item mx-2"><a class="nav-link styled-nav" href="verglasung.html">Verglasung</a></li>
            <li class="nav-item mx-2"><a class="nav-link styled-nav" href="holz.html">Holz</a></li>
            <li class="nav-item mx-2"><a class="nav-link styled-nav" href="laser.html">Laser</a></li>
            <li class="nav-item mx-2"><a class="nav-link styled-nav" href="auto.html">Auto</a></li>
          </ul>
          <ul class="navbar-nav ms-auto">
            <li class="nav-item"><a class="nav-link styled-nav btn-contact" href="#kontakt">Kontakt</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- HERO -->
    <section class="hero-banner">
      <div class="container h-100">
        <div class="row align-items-center h-100">
          <div class="col-lg-7 mt-3">
            <div class="hero-content">
              <h1 class="display-6 fw-bold mb-2">Balkonverglasung – PRISMAPANEL</h1>
              <p class="lead mb-3">
                Unabhängiges, faltbares Verglasungssystem <strong>ohne Bodenführung</strong>, mit Ablageplatz.
                Lagerung der Schiebeplatten senkrecht oder parallel zur Öffnung.
              </p>
              <a href="#verglasung-sections" class="btn btn-lg me-2">Galerie</a>
              <a href="#verglasung-sections" class="btn btn-lg">Technische Daten</a>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- СЕКЦИИ -->
    <section id="verglasung-sections" class="container py-4">
      <!-- PRISMAPANEL -->
      <div class="row align-items-start g-4 mb-5 py-5 my-4">
        <div class="col-lg-5 vcenter-lg mt-4">
          <h2 class="h4 mb-3" style="color:#4c5dc3">Balkonverglasung – PRISMAPANEL</h2>
          <p class="mb-2">
            Unabhängiges, faltbares Verglasungssystem <strong>ohne Bodenführung</strong>, mit Ablageplatz.
            Lagerung der Schiebeplatten <strong>senkrecht oder parallel</strong> zur Öffnung.
          </p>
          <ul class="mb-0">
            <li>Maximale Glasgrösse: <strong>100 × 280 cm</strong> (B × H)</li>
            <li>Maximale Glasdicke: <strong>10 mm Kristall TEMPERED</strong></li>
            <li>Wasserdichtigkeit: horizontal Dichtungsbürsten, vertikal Polycarbonat</li>
            <li>Sperren: Schloss oder Riegel</li>
            <li>Rollläden: höhenverstellbar, <strong>8 Rollen</strong></li>
          </ul>
        </div>
        <div class="col-lg-7">
          <!-- JS ќе го изгради каруселот овде -->
          <div id="carouselBalkon" class="media-carousel"></div>
        </div>
      </div>

      <!-- Wintergarten -->
      <div class="row align-items-start g-4 mb-5 py-5 my-4">
        <div class="col-lg-7 order-lg-1 order-2">
          <div id="carouselWinter" class="media-carousel"></div>
        </div>
        <div class="col-lg-5 order-lg-2 order-1">
          <h2 class="h4 mb-3" style="color:#4c5dc3">Wintergarten – 12 × 3 m</h2>
          <ul class="mb-0">
            <li>Aluminiumprofil in <strong>Anthrazit</strong> beschichtet</li>
            <li>Dach: <strong>10 mm (5+5) Sicherheitsglas</strong>, mattweiss</li>
            <li>Guillotine-System: <strong>4 Sesonglass Thermopan 4+4 mm</strong></li>
            <li>Sonnenschutzmarkisen mit <strong>Somfy-Motor</strong></li>
            <li>LED-Licht integriert, <strong>dimmbar</strong></li>
          </ul>
        </div>
      </div>

      <!-- Schiebesystemverglasung -->
      <div class="row align-items-start g-4 mb-5 py-5 my-4">
        <div class="col-lg-5">
          <h2 class="h4 mb-3" style="color:#4c5dc3">Schiebesystemverglasung</h2>
          <ul class="mb-0">
            <li><strong>8 mm (4+4) Sicherheitsglas</strong></li>
            <li>Tema-Aluminiumprofil</li>
            <li>Farbe: <strong>Weiss (oder nach wahl)</strong></li>
          </ul>
        </div>
        <div class="col-lg-7">
          <div id="carouselSchiebe" class="media-carousel"></div>
        </div>
      </div>

      <!-- Regen-/Sonnenschutz -->
      <div class="row align-items-start g-4 mb-2 py-5 my-4">
        <div class="col-lg-7 order-lg-1 order-2">
          <div id="carouselRegen" class="media-carousel"></div>
        </div>
        <div class="col-lg-5 order-lg-2 order-1">
          <h2 class="h4 mb-3" style="color:#4c5dc3">Regen-/Sonnenschutz</h2>
          <ul class="mb-0">
            <li>Glas <strong>8 mm (4+4) milchweiss</strong> – Schutz vor Regen und Sonne</li>
            <li>Saubere Integration mit Systemverglasung</li>
            <li>Rahmen/halterung aus Inox</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Lightbox -->
    <div class="modal fade" id="lightbox" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content bg-dark">
          <div class="modal-header border-0">
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body p-0 position-relative">
            <img id="lightboxImg" src="" alt="" class="w-100" style="max-height:80vh;object-fit:contain;background:#000" />
            <button id="lbPrev" class="btn btn-light position-absolute top-50 start-0 translate-middle-y ms-2">‹</button>
            <button id="lbNext" class="btn btn-light position-absolute top-50 end-0 translate-middle-y me-2">›</button>
          </div>
        </div>
      </div>
    </div>

    <!-- FOOTER -->
    <footer class="footer py-3" id="kontakt">
      <div class="container mt-5">
        <div class="row">
          <div class="col-md-4 footer-logo mx-auto">
            <img src="./images/logo.jpg" alt="PI Engineering Logo" class="footer-logo mb-3"
                 decoding="async" loading="lazy" width="300" height="150" />
          </div>
          <div class="col-md-4 mb-4">
            <h5 class="footer-title">PI Engineering GmbH</h5>
            <p>Neumattstrasse 50<br />2562 Port</p>
          </div>
          <div class="col-md-4 mb-4">
            <h5 class="footer-title">Kontakt</h5>
            <p>
              +41 79 584 15 27<br />
              <a href="mailto:info@pi-engineering.ch" class="footer-link">info@pi-engineering.ch</a>
            </p>
          </div>
        </div>
        <div class="text-center mt-3">
          <small>&copy; 2025 PI Engineering GmbH. Alle Rechte vorbehalten.</small>
        </div>
      </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

    <!-- App JS (генерирање карусели + lightbox + оптимизации) -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // ====== 1) ДЕФИНИЦИИ (само имиња на фајлови) ======
        const BASE = './images/Staklo/';
        const galleries = {
          carouselBalkon:  ['10.jpg','11.jpg','12.jpg','13.jpg','14.jpg','15.jpg','16.jpg','17.jpg'],
          carouselWinter:  ['20.jpg','23.jpg','24.jpg','25.jpg','27.jpg','28.jpg','29.9.jpg','29.99.jpg','29.999.jpg'],
          carouselSchiebe: ['32.jpg','33.jpg','34.jpg','37.jpg','38.jpg','39.9.jpg','39.999.jpg'],
          carouselRegen:   ['40.jpg','41.jpg']
        };
        const sizes = '(max-width: 576px) 100vw, (max-width: 992px) 90vw, 700px';

        // ====== 2) ГРАДЕЊЕ КАРУСЕЛ ======
        function buildCarousel(id, files) {
          const host = document.getElementById(id);
          if (!host) return;

          const inner = files.map((name, i) => {
            const src = BASE + name;
            const active = i === 0 ? ' active' : '';
            return `
              <div class="carousel-item${active}">
                <img src="${src}" srcset="${src} 1200w" sizes="${sizes}"
                     class="d-block w-100" alt="${name}"
                     ${i ? 'loading="lazy"' : ''} decoding="async"
                     width="1600" height="900">
              </div>`;
          }).join('');

          const indicators = files.map((_, i) =>
            `<button type="button" data-bs-target="#${id}" data-bs-slide-to="${i}" ${i ? '' : 'class="active"'}></button>`
          ).join('');

          host.outerHTML = `
            <div id="${id}" class="carousel slide rounded-4 overflow-hidden shadow media-carousel"
                 data-bs-ride="false" data-bs-interval="2800" data-bs-pause="false">
              <div class="carousel-inner">${inner}</div>
              <button class="carousel-control-prev" type="button" data-bs-target="#${id}" data-bs-slide="prev">
                <span class="carousel-control-prev-icon"></span><span class="visually-hidden">Prev</span>
              </button>
              <button class="carousel-control-next" type="button" data-bs-target="#${id}" data-bs-slide="next">
                <span class="carousel-control-next-icon"></span><span class="visually-hidden">Next</span>
              </button>
              <div class="carousel-indicators">${indicators}</div>
            </div>`;
        }

        // Изгради ги сите
        Object.entries(galleries).forEach(([id, files]) => buildCarousel(id, files));

        // После градење – листај ги сите карусели
        const carousels = Array.from(document.querySelectorAll('.carousel'));

        // Осигурај прв .carousel-item да е active (safety)
        carousels.forEach(c => {
          if (!c.querySelector('.carousel-item.active')) {
            const first = c.querySelector('.carousel-item');
            if (first) first.classList.add('active');
          }
        });

        // ====== 3) Lazy init + пауза offscreen (подобрен INP/LCP) ======
        const initCarousel = (el) => {
          if (el._inited) return;
          el._inited = true;
          el._inst = new bootstrap.Carousel(el, {
            interval: 2800,
            ride: 'carousel',
            pause: false,
            touch: true,
            keyboard: true
          });
        };

        const io = 'IntersectionObserver' in window
          ? new IntersectionObserver((entries) => {
              entries.forEach((e) => {
                const el = e.target;
                if (e.isIntersecting) { initCarousel(el); el._inst && el._inst.cycle(); }
                else { el._inst && el._inst.pause(); }
              });
            }, { threshold: 0.25 })
          : null;

        carousels.forEach((c) => { if (io) io.observe(c); else initCarousel(c); });

        // ====== 4) LIGHTBOX ======
        const modalEl = document.getElementById('lightbox');
        const modal   = new bootstrap.Modal(modalEl);
        const imgEl   = document.getElementById('lightboxImg');
        const prevBtn = document.getElementById('lbPrev');
        const nextBtn = document.getElementById('lbNext');

        // Сними URLs на слики во data-attr за брз пристап
        carousels.forEach((car) => {
          const list = Array.from(car.querySelectorAll('.carousel-item img')).map(i => i.src);
          car.dataset.urls = JSON.stringify(list);
        });

        let urls = [], idx = 0;
        const show = () => {
          if (!urls.length) return;
          if (idx < 0) idx = urls.length - 1;
          if (idx >= urls.length) idx = 0;
          imgEl.src = urls[idx];
        };

        document.addEventListener('click', (e) => {
          const img = e.target.closest('.carousel .carousel-item img');
          if (!img) return;
          const carousel = img.closest('.carousel');
          urls = JSON.parse(carousel.dataset.urls || '[]');
          idx = urls.indexOf(img.src);
          if (idx < 0) idx = 0;
          modal.show();
          requestAnimationFrame(show);
        });

        prevBtn.addEventListener('click', () => { idx--; show(); });
        nextBtn.addEventListener('click', () => { idx++; show(); });

        modalEl.addEventListener('keydown', (e) => {
          if (e.key === 'ArrowLeft')  { idx--; show(); }
          if (e.key === 'ArrowRight') { idx++; show(); }
        });
        modalEl.addEventListener('shown.bs.modal', () => modalEl.focus());

        // ====== 5) Почитувај reduced-motion ======
        if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
          carousels.forEach(c => { c._inst && c._inst.pause(); });
        }
      });
    </script>
  </body>
</html>
