<!DOCTYPE html>
<html lang="de-CH">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PI-ENGINEERING</title>

    <!-- Networking hints -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="dns-prefetch" href="//cdn.jsdelivr.net">

    <!-- Bootstrap CSS (same version) -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
      crossorigin="anonymous"
    />

    <!-- Preload likely LCP images -->
    <link rel="preload" as="image" href="./images/logo.jpg" imagesizes="48px">
    <link rel="preload" as="image" href="./images/Laser/20211120_103939.jpg" imagesizes="(max-width:991px) 50vw, (max-width:1199px) 33vw, 25vw">

    <link rel="stylesheet" href="./styling/laser.css">
    <link rel="icon" href="./images/logo.jpg" sizes="16x16" type="image/png">
  </head>

  <body>
    <nav class="navbar navbar-expand-lg bg-color py-3">
      <div class="container-fluid">
        <a class="navbar-brand" href="index.html">
          <img src="./images/logo.jpg" alt="Logo" class="logo" fetchpriority="high" decoding="async">
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
          aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav mx-auto">
            <li class="nav-item mx-2">
              <a class="nav-link styled-nav" href="verglasung.html">Verglasung</a>
            </li>
            <li class="nav-item mx-2">
              <a class="nav-link styled-nav" href="holz.html">Holz</a>
            </li>
            <li class="nav-item mx-2">
              <a class="nav-link styled-nav" href="laser.html">Laser</a>
            </li>
            <li class="nav-item mx-2">
              <a class="nav-link styled-nav" href="auto.html">Auto</a>
            </li>
          </ul>
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link styled-nav btn-contact" href="#kontakt">Kontakt</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- ===== LASER: HERO ===== -->
    <section class="container py-4">
      <div class="row align-items-center">
        <div class="col-lg-8">
          <h1 class="display-6 fw-bold text-brand mb-2">Lasergravur</h1>
          <p class="lead mb-0">Lasergravur auf verschiedenen Metallen.</p>
        </div>
      </div>
    </section>

    <!-- ===== LASER: GRID (flip cards) ===== -->
    <section class="container pb-5">
      <div id="laserGrid" class="row g-3"></div>
    </section>

    <!-- Modal за преглед -->
    <div class="modal fade" id="laserModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content bg-transparent border-0">
          <button type="button" class="btn btn-light ms-auto me-2 mt-2" data-bs-dismiss="modal">×</button>
          <img id="laserModalImg" src="" alt="Preview" class="w-100 rounded-4 shadow" decoding="async">
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="footer py-3" id="kontakt">
      <div class="container mt-5">
        <div class="row">
          <div class="col-md-4 footer-logo mx-auto">
            <img src="./images/logo.jpg" alt="PI Engineering Logo" class="footer-logo mb-3" loading="lazy" decoding="async">
          </div>
          <div class="col-md-4 mb-4">
            <h5 class="footer-title">PI Engineering GmbH</h5>
            <p>Neumattstrasse 50<br>2562 Port</p>
          </div>

          <div class="col-md-4 mb-4">
            <h5 class="footer-title">Kontakt</h5>
            <p>+41 79 584 15 27<br>
              <a href="mailto:info@pi-engineering.ch" class="footer-link">info@pi-engineering.ch</a>
            </p>
          </div>
        </div>
      </div>
      <div class="text-center mt-3">
        <small>&copy; 2025 PI Engineering GmbH. Alle Rechte vorbehalten.</small>
      </div>
    </footer>

    <!-- Bootstrap bundle (deferred so it doesn't block LCP) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" defer></script>

    <script>
      (() => {
        const BASE = "./images/Laser/";

        const files = [
          "20211120_103939.jpg","20211120_104001.jpg","20211122_204232.jpg",
          "20211223_174629.jpg","20211224_180039.jpg","20220111_180212.jpg",
          "20220116_142633.jpg","20220206_160655.jpg","20220206_160807.jpg",
          "20220211_172116.jpg","20220705_151704.jpg","20220706_094911.jpg",
          "20220722_070915.jpg","20220811_061152.jpg","20221127_124531.jpg",
          "20221127_125807.jpg","20221127_131032.jpg","20221127_131431.jpg",
          "20221204_115621.jpg","20221204_115649.jpg",
          "20240123_195925.jpg","20240124_185836.jpg","20240819_073152.jpg",
          "IMG-20200902-WA0000.jpg","IMG-20210426-WA0002.jpeg","IMG-20230206-WA0003.jpg"
        ];

        const grid = document.getElementById('laserGrid');

        const makeCardHTML = (name, { eager = false } = {}) => {
          const safe = encodeURIComponent(name);
          const src  = `${BASE}${safe}`;
          const imgAttrs = eager
            ? `src="${src}" loading="eager" fetchpriority="high" decoding="async"`
            : `src="" data-src="${src}" loading="lazy" fetchpriority="low" decoding="async"`;
          return `
            <div class="col-6 col-md-4 col-lg-3 laser-col">
              <div class="laser-card" data-img="${src}">
                <div class="laser-inner">
                  <div class="laser-face laser-front">
                    <img ${imgAttrs} alt="">
                  </div>
                  <div class="laser-face laser-back">
                    <img ${imgAttrs} alt="">
                  </div>
                </div>
              </div>
            </div>`;
        };

        // ------- Lazy loader helpers -------
        const hasIO = 'IntersectionObserver' in window;
        let io = null;
        if (hasIO) {
          io = new IntersectionObserver((entries) => {
            for (const entry of entries) {
              if (!entry.isIntersecting) continue;
              const img = entry.target;
              const dataSrc = img.getAttribute('data-src');
              if (dataSrc) {
                img.src = dataSrc;
                img.removeAttribute('data-src');
              }
              io.unobserve(img);
            }
          }, { rootMargin: '200px 0px' });
        }

        const observeOrLoadNow = (root = grid) => {
          const imgs = root.querySelectorAll('img[data-src]');
          if (!imgs.length) return;
          if (io) {
            imgs.forEach(img => io.observe(img));
          } else {
            // Fallback: browsers without IO → load immediately
            imgs.forEach(img => {
              img.src = img.getAttribute('data-src');
              img.removeAttribute('data-src');
            });
          }
        };

        // ------- Initial render (batch 1) -------
        const FIRST_BATCH = 8;
        const initial = files.slice(0, FIRST_BATCH);
        const rest    = files.slice(FIRST_BATCH);

        grid.innerHTML = initial
          .map((name, idx) => makeCardHTML(name, { eager: idx === 0 }))
          .join("");

        // Observe the lazy images in the initial batch
        observeOrLoadNow(grid);

        // ------- Append remaining items (batch 2) -------
        const appendRest = () => {
          grid.insertAdjacentHTML('beforeend', rest.map(n => makeCardHTML(n)).join(''));
          // IMPORTANT: start observing *after* they are in the DOM
          observeOrLoadNow(grid);
        };

        if ('requestIdleCallback' in window) {
          requestIdleCallback(appendRest, { timeout: 1000 });
        } else {
          setTimeout(appendRest, 0);
        }

        // Modal preview on click
        let modal;
        const modalImg = document.getElementById('laserModalImg');
        grid.addEventListener('click', (e) => {
          const card = e.target.closest('.laser-card');
          if (!card) return;
          if (!modal) modal = new bootstrap.Modal('#laserModal');
          modalImg.src = card.getAttribute('data-img');
          modal.show();
        });

        document.getElementById('laserModal').addEventListener('hidden.bs.modal', () => {
          modalImg.src = "";
        });
      })();
    </script>
  </body>
</html>
